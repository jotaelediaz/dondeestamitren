{% extends "base-layout.html" %}

{% block title %}Mapa del tren {{ train.train_id }}{% endblock %}

{% block app_content %}
<section class="line-route app-main-content" aria-label="Mapa del tren {{ train.train_id }}">
    <div class="app-block-padding sticky-title">
        <div class="line-chip-header">
            <div class="line-chip-icon chip-icon-group train-detail-header">
                <div class="line-chip-icon cercanias-logo-icon">
                    <img alt="Cercanías" src="/static/img/icon-cercanias.svg">
                </div>
                <div class="route-train-chip-icon chip-icon">
                    <i class="material-symbols-rounded" aria-hidden="true">map</i>
                </div>
            </div>
            <h2 class="line-name">Mapa del tren {{ train.train_id }}</h2>
            <div class="line-chip-header-buttons"></div>
        </div>
    </div>
	
<div class="train-map-container">
    <div id="train-map"
         data-train-map="true"
         role="region"
         aria-label="Mapa con la posición actual del tren"
         data-map-lat="{{ position.lat }}"
         data-map-lon="{{ position.lon }}"
         data-map-heading="{{ position.heading or 0 }}"
         data-map-train="{{ train.train_id }}"
         data-map-route-id="{{ route_debug.route_id if route_debug else '' }}"
         data-map-route-dir="{{ route_debug.direction_id if route_debug else '' }}"
         data-map-api="{{ position_api or '' }}"
         data-map-line-color="{{ route.color_bg if route else '' }}"
         data-map-route="{{ train_service.route_short_name or route.route_short_name if route else '' }}"
         {% if route_geojson %}data-map-route-geojson='{{ route_geojson | tojson }}'{% endif %}
         {% if route_stops_geojson %}data-map-stops-geojson='{{ route_stops_geojson | tojson }}'{% endif %}
         {% if route %}data-map-route-color="{{ route.color_bg if route else '' }}"{% endif %}>
    </div>
    {% if route_geojson %}
    <script id="train-route-geojson" type="application/json">{{ route_geojson | tojson }}</script>
    {% endif %}
    {% if route_stops_geojson %}
    <script id="train-route-stops-geojson" type="application/json">{{ route_stops_geojson | tojson }}</script>
    {% endif %}
    {% if route_debug %}
    <p class="train-map-debug" style="font-size: 0.9rem; color: #666; margin-top: 0.5rem;">
        Debug ruta: route_id={{ route_debug.route_id or '—' }}, dir={{ route_debug.direction_id or '—' }}, coords={{ route_debug.coords }}
    </p>
    {% endif %}
</div>
</section>
{% endblock %}

{% block action_buttons %}
    <div id="action-buttons-items" hx-swap-oob="true"></div>
{% endblock %}
