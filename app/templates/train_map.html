{% extends "base-layout.html" %}

{% block title %}Mapa del tren {{ train.train_id }}{% endblock %}

{% block app_content %}
<section class="line-route app-main-content" aria-label="Mapa del tren {{ train.train_id }}">
    <div class="app-block-padding sticky-title">
        <div class="line-chip-header">
            <div class="line-chip-icon chip-icon-group train-detail-header">
                <div class="line-chip-icon cercanias-logo-icon">
                    <img alt="Cercanías" src="/static/img/icon-cercanias.svg">
                </div>
                <div class="route-train-chip-icon chip-icon">
                    <i class="material-symbols-rounded" aria-hidden="true">map</i>
                </div>
            </div>
            <h2 class="line-name">Mapa del tren {{ train.train_id }}</h2>
            <div class="line-chip-header-buttons"></div>
        </div>
    </div>
	
{% with
    map_element_id='train-map',
    map_position=position,
    map_train_label=train.train_id,
    map_route_id=route_debug.route_id if route_debug else '',
    map_direction_id=route_debug.direction_id if route_debug else '',
    map_api=position_api or '',
    map_line_color=route.color_bg if route else '',
    map_route_name=train_service.route_short_name or route.route_short_name if route else '',
    map_route_geojson=route_geojson,
    map_route_stops_geojson=route_stops_geojson
%}
    {% include 'partials/train_map_embed.html' %}
{% endwith %}
{% if route_geojson %}
<script id="train-route-geojson" type="application/json">{{ route_geojson | tojson }}</script>
{% endif %}
{% if route_stops_geojson %}
<script id="train-route-stops-geojson" type="application/json">{{ route_stops_geojson | tojson }}</script>
{% endif %}
{% if route_debug %}
<p class="train-map-debug" style="font-size: 0.9rem; color: #666; margin-top: 0.5rem;">
    Debug ruta: route_id={{ route_debug.route_id or '—' }}, dir={{ route_debug.direction_id or '—' }}, coords={{ route_debug.coords }}
</p>
{% endif %}
</section>
{% endblock %}

{% block action_buttons %}
    <div id="action-buttons-items" hx-swap-oob="true"></div>
{% endblock %}
