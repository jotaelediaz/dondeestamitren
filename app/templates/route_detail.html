{%- extends "base-layout.html" %}
{%- from "partials/helper_macros.html" import get_cercanias_line_icon, print_station_route_map with context %}
{%- block app_content %}
	
	<section id="line-route" class="line-route app-main-content" aria-label="Ruta de la línea {{ route.route_long_name if route else '' }}">
			<div class="grouped-lists-scroll">
						<div class="app-block-padding sticky-title">
							<h2 class="app-block-title">➜ {{ route.route_short_name }} · {{ route.route_long_name }}
								<span class="title-badge cercanias-badge"><img alt="Cercanías" src="/static/img/icon-cercanias.svg"></span>
							</h2>
						</div>
						<div class="app-block-padding">
							<ul class="grid-route-map" data-number-of-stations="{{ route.stations|length }}" style="--number-of-stations: {{ route.stations|length }};">
								{% for stop in route.stations %}
									{{ print_station_route_map(stop) }}
								{% endfor %}
							</ul>
						</div>
			</div>
		
		<h2 class="text-xl font-semibold mb-2">Trenes circulando en esta ruta hacia {{ repo.get_stop_name(repo.route_destination(route.route_id)) or '—' }} <i>({{ repo.route_destination(route.route_id) }})</i></h2>
		
		{% if not trains or trains|length == 0 %}
		<p>No se encuentran trenes circulando en esta línea ahora mismo.</p>
		{% else %}
		<table border="1" cellpadding="6" cellspacing="0">
			<thead>
			<tr>
				<th>Tren</th>
				<th>Estado</th>
				<th>Parada actual</th>
				<th>Posición</th>
			</tr>
			</thead>
			<tbody>
			{% for t in trains %}
				<tr>
					<td><a href="/trains/{{ nucleus.slug }}/{{ t.train_id }}">{{ t.train_id }}</a></td>
					<td>{{ t.status_human() }}</td>
					<td>{{ repo.get_stop_name(t.stop_id) }} <i>({{ t.stop_id or "—" }})</i></td>
					<td>
						{% if t.lat and t.lon %}
							{{ '%.5f'|format(t.lat) }}, {{ '%.5f'|format(t.lon) }}
						{% else %}—{% endif %}
					</td>
				</tr>
			{% endfor %}
			</tbody>
		</table>
	</section>
	{% endif %}
	
{%- endblock %}