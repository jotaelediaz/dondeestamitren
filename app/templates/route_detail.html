<!doctype html><meta charset="utf-8">
<title>{{ line.route_short_name }} – {{ line.route_long_name }}</title>

<h1>
	{{ line.route_short_name }} — {{ line.route_long_name }}
	{% if line.direction_id %}<small class="muted">(dir {{ line.direction_id }})</small>{% endif %}
</h1>

{% if directions and directions|length > 1 %}
	<div class="dir">
		Cambiar sentido:
		{% for d in directions %}
			{% if d == line.direction_id %}
				<strong>[{{ d if d else "∅" }}]</strong>
			{% else %}
				<a href="/routes/{{ nucleus }}/{{ key }}{% if d %}?direction_id={{ d }}{% endif %}">
					dir {{ d if d else "∅" }}
				</a>
			{% endif %}
		{% endfor %}
	</div>
{% endif %}

<table>
	<thead>
	<tr>
		<th>Orden</th>
		<th>Parada</th>
		<th>KM</th>
		<th>Coordenadas</th>
		<th>% línea</th>
	</tr>
	</thead>
	<tbody>
	{% for s in line.stations %}
		{% set pct = (s.km / (line.length_km or 1)) * 100 %}
		<tr>
			<td>{{ s.seq + 1 }}</td>
			<td>
				<a href="/routes/{{ nucleus.slug }}/{{ line.route_id }}/stops/{{ s.stop_id }}{% if line.direction_id %}?direction_id={{ line.direction_id }}{% endif %}">
					{{ s.stop_name or repo.get_stop_name_or_id(s.stop_id) }}
				</a>
				<i>({{ s.stop_id }})</i>
			</td>
			<td>{{ '%.1f'|format(s.km) }}</td>
			<td>{{ '%.5f'|format(s.lat) }}, {{ '%.5f'|format(s.lon) }}</td>
			<td>{{ '%.0f'|format(pct) }}%</td>
		</tr>
	{% endfor %}
	</tbody>
</table>


<hr>
<h2 class="text-xl font-semibold mb-2">Trenes circulando en esta línea</h2>

{% if not trains or trains|length == 0 %}
	<p>No se encuentran trenes circulando en esta línea ahora mismo.</p>
{% else %}
	<table class="table" style="width:100%; max-width: 960px;">
		<thead>
			<tr>
				<th>Tren</th>
				<th>Estado</th>
				<th>Parada</th>
				<th>Posición</th>
			</tr>
		</thead>
		<tbody>
		{% for t in trains %}
			<tr>
				<td><a href="/train/{{ t.train_id }}">{{ t.train_id }}</a></td>
				<td>{{ t.status_human() }}</td>
				<td>{{ repo.get_stop_name(t.stop_id) }} <i>({{ t.stop_id or "—" }})</i></td>
				<td>
					{% if t.lat and t.lon %}
						{{ '%.5f'|format(t.lat) }}, {{ '%.5f'|format(t.lon) }}
					{% else %}—{% endif %}
				</td>
			</tr>
		{% endfor %}
		</tbody>
	</table>
{% endif %}
