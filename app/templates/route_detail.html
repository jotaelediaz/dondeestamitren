{%- extends "base-layout.html" %}
{%- from "partials/helper_macros.html" import get_cercanias_line_icon, print_station_route_map with context %}
{%- block app_content %}
	
	<section id="line-route" class="line-route app-main-content" aria-label="Ruta de la línea {{ route.route_long_name if route else '' }}">
			<div class="grouped-lists-scroll">
				<div class="app-block-padding sticky-title">
					<div class="line-chip-header">
						<div class="line-chip-icon chip-icon" >
							{{ get_cercanias_line_icon(route.route_short_name, route.nucleus_id, route.color_bg) }}
						</div>
						<h2 class="line-name">
							{% set origin_name, destination_name = route.terminals_names %} {{ destination_name }}
						</h2>
						<div class="line-chip-header-buttons ">
							{% set reverse_id = repo.get_opposite_route_id(route.route_id) %}
							{% if reverse_id %}
								<a class="line-chip-header-button line-toggle-reverse" href="/routes/{{ nucleus.slug }}/{{ reverse_id }}" title="Ver sentido inverso" aria-label="Ver sentido inverso" rel="alternate">
									<i class="material-symbols-rounded" aria-hidden="true" style="font-size:1.2rem;line-height:1;">swap_vert</i>
								</a>
							{% endif %}
						</div>
					</div>
				</div>
				
				<div class="app-block-padding app-block-vertical-padding">
					<ul class="grid-route-map" data-number-of-stations="{{ route.stations|length }}" style="--number-of-stations: {{ route.stations|length }}; --line-color: {{ route.color_bg }};">
						{% for stop in route.stations %}
							<li class="grid-route-map-station {{ 'origin-station' if route.origin.stop_id == stop.stop_id else 'destination-station' if route.destination.stop_id == stop.stop_id else 'mid-station' }}">
								{{ print_station_route_map(stop, route.route_short_name) }}
							</li>
						{% endfor %}
					</ul>
				</div>
				
				
						<h2 class="text-xl font-semibold mb-2">Trenes circulando en esta ruta</h2>

						{% if not trains or trains|length == 0 %}
						<p>No se encuentran trenes circulando en esta línea ahora mismo.</p>
						{% else %}
						<table border="1" cellpadding="6" cellspacing="0">
							<thead>
							<tr>
								<th>Tren</th>
								<th>Estado</th>
								<th>Parada actual</th>
							</tr>
							</thead>
							<tbody>
							{% for t in trains %}
								<tr>
									<td><a href="/trains/{{ nucleus.slug }}/{{ t.train_id }}">{{ t.train_id }}</a></td>
									<td>{{ t.status_human() }}</td>
									<td>{{ repo.get_stop_name(t.stop_id) }} <i>({{ t.stop_id or "—" }})</i></td>
								</tr>
							{% endfor %}
							</tbody>
						</table>
		</div>
	{% endif %}
	</section>
{%- endblock %}

{%- block extra_stylesheets -%}
{#	<link rel="preload" href="{{ request.url_for('static', path='fonts/Via-Medium.woff2') }}" as="font" type="font/woff2" crossorigin>
	<link rel="preload" href="{{ request.url_for('static', path='fonts/Via-Bold.woff2') }}" as="font" type="font/woff2" crossorigin>
	<link rel="stylesheet" href="/static/css/mitren-renfe-style.css">#}
{%- endblock -%}

{% block bottom_navbar %}
{% endblock %}