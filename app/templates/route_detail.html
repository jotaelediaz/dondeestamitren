<!doctype html><meta charset="utf-8">
<title>{{ route.route_short_name }} – {{ route.route_long_name }}</title>

<h1>
	Ruta {{ route.route_id }} ➜ {{ route.route_short_name }} · {{ route.route_long_name }}
</h1>

<table border="1" cellpadding="6" cellspacing="0">
	<thead>
	<tr>
		<th>Orden</th>
		<th>Parada</th>
		<th>KM</th>
		<th>Coordenadas</th>
		<th>% línea</th>
	</tr>
	</thead>
	<tbody>
	{% for s in route.stations %}
		{% set pct = (s.km / (route.length_km or 1)) * 100 %}
		<tr>
			<td>{{ s.seq + 1 }}</td>
			<td>
				<a href="/routes/{{ nucleus.slug }}/{{ route.route_id }}/stops/{{ s.stop_id }}{% if route.direction_id %}?direction_id={{ route.direction_id }}{% endif %}">
					{{ s.stop_name or repo.get_stop_name_or_id(s.stop_id) }}
				</a>
				<i>({{ s.stop_id }})</i>
			</td>
			<td>{{ '%.1f'|format(s.km) }}</td>
			<td>{{ '%.5f'|format(s.lat) }}, {{ '%.5f'|format(s.lon) }}</td>
			<td>{{ '%.0f'|format(pct) }}%</td>
		</tr>
	{% endfor %}
	</tbody>
</table>

<hr>

<h2 class="text-xl font-semibold mb-2">Trenes circulando en esta ruta hacia {{ repo.get_stop_name(repo.route_destination(route.route_id)) or '—' }} <i>({{ repo.route_destination(route.route_id) }})</i></h2>

{% if not trains or trains|length == 0 %}
	<p>No se encuentran trenes circulando en esta línea ahora mismo.</p>
{% else %}
	<table border="1" cellpadding="6" cellspacing="0">
		<thead>
		<tr>
			<th>Tren</th>
			<th>Ruta</th>
			<th>Destino</th>
			<th>Estado</th>
			<th>Parada actual</th>
			<th>Posición</th>
		</tr>
		</thead>
		<tbody>
		{% for t in trains %}
			<tr>
				<td><a href="/trains/{{ nucleus.slug }}/{{ t.train_id }}">{{ t.train_id }}</a></td>
				<td>{{ t.route_id }}</td>
				<td>→ {{repo.get_stop_name(repo.route_destination(t.route_id)) or '—' }}</td>
				<td>{{ t.status_human() }}</td>
				
				
				<td>{{ repo.get_stop_name(t.stop_id) }} <i>({{ t.stop_id or "—" }})</i></td>
				<td>
					{% if t.lat and t.lon %}
						{{ '%.5f'|format(t.lat) }}, {{ '%.5f'|format(t.lon) }}
					{% else %}—{% endif %}
				</td>
			</tr>
		{% endfor %}
		</tbody>
	</table>
{% endif %}
