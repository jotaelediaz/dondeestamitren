<h1 class="h2">
	Trenes{% if nucleus %} en {{ nucleus.name }}{% endif %}
	{% if live_only %}<small>(solo en vivo)</small>{% else %}<small>(en vivo + programados)</small>{% endif %}
</h1>

<p class="text-muted">Snapshot: {{ last_snapshot }}</p>
<p class="text-muted">Fuente: {{ (last_source or '—')|upper }}</p>

{% if not nucleus %}
	<h2>Trenes por núcleos</h2>
	<ul>
		{% for n in nuclei %}
			<li>
				<a href="/alpha/trains/{{ n.slug }}">{{ n.name }}</a>
				&nbsp;·&nbsp;
				<a href="/alpha/trains/{{ n.slug }}?live_only=1">Solo live</a>
			</li>
		{% endfor %}
	</ul>
	<hr>
{% endif %}

{% if nucleus %}
	<p style="margin: .5rem 0 1rem 0;">
		{% if live_only %}
			<a href="/alpha/trains/{{ nucleus.slug }}">Ver live + programados</a>
		{% else %}
			<a href="/alpha/trains/{{ nucleus.slug }}?live_only=1">Ver solo live</a>
		{% endif %}
	</p>
{% endif %}

{% if rows is not defined or rows|length == 0 %}
	<p>No hay datos para mostrar.</p>
{% else %}
	<table class="table" style="width:100%; max-width: 1120px;">
		<thead>
		<tr>
			<th>Línea</th>
			<th>Tren</th>
			<th>Tipo</th>
			<th>Estado / Salida</th>
			<th>Parada</th>
			<th>Posición</th>
		</tr>
		</thead>
		<tbody>
		{% for r in rows %}
			<tr>
				<td>{{ r.route_short_name or r.route_id or '—' }}</td>
				<td>
					<a href="/alpha/trains/{{ r.nucleus_slug }}/{{ r.id }}">{{ r.train_label }}</a>
				</td>
				<td>{{ 'LIVE' if r.kind == 'live' else 'PROG.' }}</td>
				<td>
					{% if r.kind == 'live' %}
						{{ r.status_text }}
					{% else %}
						{{ r.status_text }}
					{% endif %}
				</td>
				<td>
					{% if r.kind == 'live' %}
						{{ repo.get_stop_name(r.stop_id) }} <i>({{ r.stop_id or "—" }})</i>
					{% else %}
						—
					{% endif %}
				</td>
				<td>
					{% if r.kind == 'live' and r.lat and r.lon %}
						{{ '%.5f'|format(r.lat) }}, {{ '%.5f'|format(r.lon) }}
					{% else %}—{% endif %}
				</td>
			</tr>
		{% endfor %}
		</tbody>
	</table>
{% endif %}

<p><a href="/alpha/">← Volver</a></p>

<script>
    setTimeout(() => location.reload(), 200000);
</script>
