{% if not trains %}
	<p>No se encuentran trenes circulando en esta línea ahora mismo.</p>
{% else %}
	<div class="drawer-header">
		<form class="display-none" id="rtp-ctx">
			<input type="hidden" name="dir" value="{{ dir|default('0') }}">
			<input type="hidden" name="source_rid" value="{{ source_rid|default('') }}">
		</form>
		<div class="drawer-title-group">
      <span class="live-pill {{ 'is-stale' if is_stale else '' }}" title="{{ 'Datos desactualizados' if is_stale else 'En directo' }}" role="status" aria-live="polite"><i class="dot" aria-hidden="true"></i></span>
			<h3 class="drawer-title">
				<span class="title-content">Trenes en esta ruta</span>
				<span class="muted">Actualizado: {{ last_snapshot|fmt_dt('time', 'Europe/Madrid') }}</span>
			</h3>
		</div>
		<button class="navbar-button bottom-nav-secondary-button"
		        type="button"
		        id="update-route-train-list"
		        hx-get="/lines/{{ nucleus.slug }}/{{ line.line_id }}/trains"
		        hx-target="#route-trains-body"
		        hx-swap="innerHTML"
		        hx-include="#rtp-ctx"
		        title="Actualizar trenes"
		        aria-label="Actualizar trenes">
			<i class="material-symbols-rounded" aria-hidden="true">cached</i>
		</button>
	</div>
	
	<ul class="train-list grouped-lists-scroll-horizontal" hx-boost="true">
		{% for t in trains %}
			{% set train_route = repo.get_by_route_and_dir(t.route_id, dir) or repo.get_by_route_and_dir(t.route_id, "") %}
			<li class="route-train-chip-card chip-card" style="--train-color: {{ train_route.color_bg }};">
				<a href="/trains/{{ nucleus.slug }}/{{ t.train_id }}"
				   hx-target="#main"
				   hx-swap="innerHTML transition:true"
				   hx-push-url="true">
					<div class="route-train-chip-header">
						<div class="route-train-chip-icon chip-icon"><i class="material-symbols-rounded" aria-hidden="true">train</i></div>
						<h4 class="train-name chip-name">{{ t.train_id }}</h4>
					</div>
					<div class="route-train-chip-body">
						<span class="route-train-chip-stop-name">{{ repo.get_stop_name(t.stop_id) or 'Parada ' + t.stop_id or '—' }}</span>
					</div>
				</a>
				<div class="route-train-different-route-indicator">
					{% if (source_rid != train_route.route_id) %}
						<i class="material-symbols-rounded" title="Ruta distinta de la visualizada">arrow_split</i>
					{% endif %}
				</div>
			</li>
		{% endfor %}
	</ul>
{% endif %}
