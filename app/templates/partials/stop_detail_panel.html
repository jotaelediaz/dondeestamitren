<div class="stop-detail">
	<header class="bottom-card-modal-header">
		<h1 id="stop-modal-title">{{ stop.name }}</h1>
	</header>
	
	<section>
		<p>➜ <a href="/stations/{{ nucleus.slug }}/{{ stop.station_id | urlencode }}">Ver ficha de estación</a></p>
		
		<h2>Tren más cercano a la parada</h2>
		
		{% if nearest_trains and nearest_trains|length > 0 %}
			{# toma el primero: va ordenado por cercanía #}
			{% set nearest_pair = nearest_trains[0] %}
			{% set nearest = nearest_pair[0] %}
			{% set nearest_eta = nearest_pair[1] %}
			
			<div class="nearest-train-card chip-card" style="--train-color: {{ route.color_bg }}">
				<div class="chip-body">
					<div class="chip-title">
						<strong>{{ nearest.train.train_id }}</strong>
						{% if nearest_eta %}
							· llega en ~{{ nearest_eta.minutes_rounded }} min
						{% endif %}
					</div>
					<div class="chip-subtitle">
						{{ '%.1f'|format(nearest.delta_km|float) }} km
						{% if nearest_eta %}
							· v≈{{ '%.0f'|format(nearest_eta.speed_kmh_used) }} km/h
							· {{ nearest_eta.stops_remaining }} parada{{ 's' if nearest_eta.stops_remaining != 1 else '' }}
						{% endif %}
					</div>
				</div>
			</div>
			
			<h3>Próximos trenes</h3>
			<ul class="lista-proximos">
				{% for r, r_eta in nearest_trains %}
					<li>
						{{ r.train.train_id }} · {{ '%.1f'|format(r.delta_km|float) }} km
						{% if r_eta %} · ~{{ r_eta.minutes_rounded }} min{% endif %}
					</li>
				{% endfor %}
			</ul>
		{% else %}
			<p>No hay trenes aproximándose en este sentido ahora mismo.</p>
		{% endif %}
	</section>
</div>
