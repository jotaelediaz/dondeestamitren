<div class="stop-detail">
	{% set services_url = services_api_url if services_api_url is defined else request.url_for('upcoming_services_for_stop', route_id=route.route_id, stop_id=stop.stop_id) %}
	{% set services_limit = services_limit if services_limit is defined else 10 %}
	{% set services_tz = services_tz if services_tz is defined else 'Europe/Madrid' %}
	<div id="drawer-context"
	     data-nucleus="{{ nucleus.slug }}"
	     data-line-id="{{ route.line_id if route is defined else '' }}"
	     data-route-id="{{ route.route_id if route is defined else '' }}"
     data-dir="{{ request.query_params.get('dir') or route.direction_id or '' }}"
	     data-stop-id="{{ stop.stop_id }}"
	     data-services-url="{{ services_url }}?limit={{ services_limit }}&tz={{ services_tz }}"
	     data-services-limit="{{ services_limit }}"
	     data-services-tz="{{ services_tz }}">
	</div>

	<header class="stop-modal-header">
		<h1 id="stop-modal-title">
			<a href="/stations/{{ nucleus.slug }}/{{ stop.stop_id }}">{{ stop.name }}</a>
		</h1>
		<button class="drawer-close close-button" type="button" aria-label="Cerrar">
			<i class="material-symbols-rounded" aria-hidden="true">close</i>
		</button>
	</header>
	<ul class="stop-summary">
		<li><strong>Vía habitual:</strong> {% if habitual_platform %}{{ habitual_platform }}{% if habitual_publishable is defined and not habitual_publishable %} <i>(no publicable)</i>{% endif %}{% else %}???{% endif %}</li>
	</ul>


	<section class="stop-modal-body" data-stop-panel data-nucleus="{{ nucleus.slug }}">
		<div class="nearest-train-card train-approaching" data-stop-primary style="--train-color: {{ route.color_bg }}">
			<div class="train-eta-chip" id="eta-chip-{{ stop.stop_id }}">
				<div class="nearest-train-header eta-header" id="eta-label-{{ stop.stop_id }}">
					<span class="live-pill is-est" data-field="primary-pill" role="status" aria-live="polite" title="Próximo servicio">
						<i class="dot" aria-hidden="true"></i>
					</span>
					<span data-field="primary-label">Próximo tren en:</span>
				</div>

				<div class="train-eta-output-wrapper">
					<output id="eta-primary"
					        class="train-eta-time"
					        role="status"
					        aria-live="polite"
					        aria-atomic="true"
					        aria-labelledby="eta-label-{{ stop.stop_id }}"
					        data-field="primary-minutes"
					        data-eta-min="0">
						<time>--</time>
						<span class="unit">min</span>
					</output>

					<output id="eta-clock"
					        class="train-eta-time is-clock"
					        role="status"
					        aria-live="polite"
					        aria-atomic="true"
					        aria-labelledby="eta-label-{{ stop.stop_id }}"
					        data-field="primary-clock"
					        data-eta-min="0"
					        hidden aria-hidden="true" inert>
						<time>--:--</time>
						<span class="unit">h</span>
					</output>
				</div>

				<p class="eta-source" data-field="primary-status-text">Cargando…</p>

				<div class="second-train-approaching">
					<p class="second-train-label">
						<i class="material-symbols-rounded" aria-hidden="true">subdirectory_arrow_right</i>
						Siguiente en: <span class="second-train-eta"><strong data-field="secondary-minutes">—</strong></span>
						<span class="second-train-clock" data-field="secondary-clock"></span>
					</p>
				</div>
			</div>

			<div class="platform-chip">
				<div class="train-platform-badge" aria-labelledby="platform-label-{{ stop.stop_id }}">
					<div class="nearest-train-header platform-header" id="platform-label-{{ stop.stop_id }}">
						Vía
					</div>
					<div class="platform-badge is-unknown" data-field="platform" data-platform="—">
						<data value="—"><span class="platform-unit" data-field="platform-label">—</span></data>
					</div>
				</div>
				<p class="platform-note" data-field="platform-note"></p>
			</div>
		</div>

		<div class="stop-modal-footer" data-stop-footer style="--train-color: {{ route.color_bg }}">
			<div class="train-id-chip">
				<div class="route-train-chip-icon chip-icon">
					<i class="material-symbols-rounded" aria-hidden="true">train</i>
				</div>
				<div class="train-id-badge" data-field="train-id-wrapper">
					<a data-field="train-link" href="#" aria-label="Ver detalle del tren" hidden>
						<data value=""><span class="train-id-unit" data-field="train-id">—</span></data>
					</a>
					<span data-field="train-id-placeholder">—</span>
				</div>
			</div>
			<div class="view-train-link" data-field="train-view-link" hidden>
				<a href="#" aria-label="Ver detalle del tren" data-field="train-view-anchor">
					<i class="material-symbols-rounded" aria-hidden="true">directions_railway</i>
					Ver tren
					</a>
			</div>
		</div>

		<p class="last-seen" data-field="last-seen" hidden>Última posición hace <span data-field="last-seen-seconds">0</span> s.</p>

		<div class="error-drawer no-stop-error" data-field="empty-message" hidden>
			<i class="material-symbols-rounded" aria-hidden="true">hide_source</i>
			<span>No hay trenes aproximándose a la parada en este sentido ahora mismo.</span>
		</div>
	</section>
</div>
