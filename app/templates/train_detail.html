<header>
	{% if nucleus %}
		<a href="/alpha/trains/{{ nucleus.slug }}">&larr; Volver a {{ nucleus.name }}</a>
	{% else %}
		<a href="/alpha/trains/">&larr; Volver a trenes</a>
	{% endif %}
	
	<h1>
		Tren {{ unified.train_label }}{% if unified.kind == 'scheduled' %} (programado){% endif %}
	</h1>
	
	{% if confidence %}
		<span title="{{ confidence.tooltip }}">
      <span>{{ confidence.icon }}</span>
      <span>Confianza en la clasificaciÃ³n en rutas del tren: {{ confidence.label }}</span>
      <small>({{ confidence.source }})</small>
    </span>
	{% endif %}
	
	<p>Ãšltima actualizaciÃ³n de la API: {{ last_snapshot }} ({{ last_source or 'â€”' }})</p>
	
	{% if kind == 'live' and train %}
		<p>
			Tren visto por Ãºltima vez: {{ train_seen_iso }} â€” hace {{ train_seen_age }} s
			{{ 'ðŸ”´' if train_seen_age > 900 else 'ðŸŸ¡' if train_seen_age > 30 else 'ðŸŸ¢'}}
		</p>
	{% endif %}
</header>

<table border="1" cellpadding="6" cellspacing="0">
	<thead>
	<tr>
		<th>Ruta</th>
		<th>CÃ³digo de lÃ­nea</th>
		<th>Destino</th>
		<th>Estado</th>
		<th>Parada actual</th>
		<th>VÃ­a</th>
		<th>PosiciÃ³n</th>
	</tr>
	</thead>
	<tbody>
	<tr>
		<td>
			{% if unified.route_id %}
				<a href="/alpha/routes/{{ nucleus.slug }}/{{ unified.route_id }}">{{ unified.route_id }}</a>
			{% else %}â€”{% endif %}
		</td>
		<td>{{ unified.route_short_name or 'â€”' }}</td>
		<td>{{ unified.destination_name or 'â€”' }}</td>
		<td>{{ unified.status_text or 'â€”' }}</td>
		<td>
			{% if kind == 'live' and train %}
				{{ repo.get_stop_name(train.stop_id) }} <i>({{ train.stop_id or "â€”" }})</i>
			{% else %}â€”{% endif %}
		</td>
		<td>{{ unified.platform or 'â€”' }}</td>
		<td>
			{% if unified.lat is not none and unified.lon is not none %}
				{{ '%.5f'|format(unified.lat) }}, {{ '%.5f'|format(unified.lon) }}
			{% else %}â€”{% endif %}
		</td>
	</tr>
	</tbody>
</table>

<hr>

<h2>Servicio / Trip asociado</h2>
<table border="1" cellpadding="6" cellspacing="0">
	<thead>
	<tr>
		<th>Trip ID</th>
		<th>Salida programada</th>
	</tr>
	</thead>
	<tbody>
	<tr>
		<td>{{ unified.trip_id or 'â€”' }}</td>
		<td>
			{% if unified.scheduled_departure_hhmm %}
				{{ unified.scheduled_departure_hhmm }}
				{% if unified.scheduled_departure_epoch %} ({{ unified.scheduled_departure_epoch }}){% endif %}
			{% else %}
				â€”
			{% endif %}
		</td>
	</tr>
	</tbody>
</table>
